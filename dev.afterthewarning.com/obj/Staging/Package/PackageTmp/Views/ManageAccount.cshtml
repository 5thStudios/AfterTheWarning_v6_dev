@using ClientDependency.Core.Mvc
@using Models;

@inherits UmbracoViewPage
@{ Layout = "TopLevel.cshtml"; }


@{
    //Instantiate variables.
    string isInactive = "inactive";
    string credentialsUrl = string.Empty;
    string prayerRequestsUrl = string.Empty;
    string prayerPledgesUrl = string.Empty;
    string illuminationStoryUrl = string.Empty;


    //Obtain current page as strongly typed ip
    UmbracoHelper umbracoHelper = new UmbracoHelper(UmbracoContext.Current);
    int? currentPageId = UmbracoContext.Current.PageId;
    IPublishedContent ipCurrentPg = umbracoHelper.TypedContent(currentPageId);

    if (!User.Identity.IsAuthenticated)
    {
        //Redirect to login page.
        Response.Redirect(Umbraco.TypedContent((int)(Models.Common.siteNode.Login)).Url);
    }
    else if (ipCurrentPg.DocumentTypeAlias == Common.docType.ManageAccount)
    {
        Response.Redirect(ipCurrentPg.Children.First().Url);
    }
    else
    {
        //Instantiate variables.
        IPublishedContent ipHome = Umbraco.TypedContent((int)(Common.siteNode.Home));
        credentialsUrl = Umbraco.TypedContent((int)(Models.Common.siteNode.EditAccount)).Url;
        prayerRequestsUrl = Umbraco.TypedContent((int)(Models.Common.siteNode.PrayerRequests)).Url;
        prayerPledgesUrl = Umbraco.TypedContent((int)(Models.Common.siteNode.PrayerPledges)).Url;
        illuminationStoryUrl = Umbraco.TypedContent((int)(Models.Common.siteNode.AddEditIlluminationStory)).Url;

        //Make fields active if Illumination has occured.
        if (ipHome.GetPropertyValue<Boolean>(Common.NodeProperties.activateIlluminationControls) == true) { isInactive = string.Empty; }
    }
}



<div class="manageAccount">
    <div class="grid-x grid-padding-x">
        <div class="cell medium-8 large-6">
            <ul class="filters">
                <li data-id="0"><a href="@credentialsUrl"><h5>Credentials</h5></a></li>
                <li data-id="1"><a href="@prayerRequestsUrl"><h5>Prayer Requests</h5></a></li>
                <li data-id="2"><a href="@prayerPledgesUrl"><h5>Prayer Pledges</h5></a></li>
                <li data-id="3" class="@isInactive"><a href="@illuminationStoryUrl"><h5>Illumination Story</h5></a></li>
            </ul>
            <br />
        </div>
        <div class="cell medium-16 large-18 form">
            @if (ipCurrentPg.DocumentTypeAlias != Common.docType.ManageAccount)
            {
                @RenderBody()
            }
        </div>
    </div>
</div>


@section Footer {
    <script type="text/javascript" src="~/Scripts/custom/manageAcct.js"></script>

    @if (ipCurrentPg.DocumentTypeAlias != Common.docType.ManageAccount)
    {
        @RenderSection("Footer", false)
    }
}